<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Quality Kit - 引文分析工具</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <h1>AI Quality Kit</h1>
        <p>上传Excel文件进行引文分析，支持Fulltext（完整引文分析）和Sliced（引文一致性评估）模式</p>
        
        <!-- API配置区域 -->
        <div class="config-section">
            <h3>API配置</h3>
            
            <div class="input-group">
                <label for="api-provider">API提供商:</label>
                <select id="api-provider" required>
                    <option value="alibaba">阿里云百炼 (Qwen)</option>
                    <option value="openai">OpenAI (GPT)</option>
                    <option value="deepseek">DeepSeek</option>
                    <option value="nuwaapi">NuwaAPI (代理服务)</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="model-name" id="model-label">模型名称:</label>
                <input type="text" id="model-name" placeholder="请输入模型名称..." required>
                <small class="form-help" id="model-help">默认模型会根据提供商自动填入</small>
            </div>
            
            <div class="input-group">
                <label for="api-key" id="api-key-label">百炼API Key:</label>
                <input type="password" id="api-key" placeholder="请输入API Key..." required>
            </div>
            
            <div class="input-group api-advanced-options" style="display: none;">
                <label for="api-base-url">自定义URL:</label>
                <input type="text" id="api-base-url" placeholder="可选，留空使用默认URL">
                <small class="form-help">用于自定义API端点，如中转服务</small>
            </div>
            
            <div class="input-group">
                <label>
                    <input type="checkbox" id="show-advanced-api"> 显示高级选项
                </label>
            </div>
        </div>

        <!-- 文件上传区域 -->
        <div class="upload-section">
            <h3>文件上传</h3>
            <div class="file-upload">
                <input type="file" id="file-input" accept=".xlsx" required>
                <label for="file-input" class="file-label">选择Excel文件 (.xlsx)</label>
                <div id="file-info" class="file-info"></div>
            </div>
        </div>

        <!-- 分析选项 -->
        <div class="analysis-options">
            <h3>分析选项</h3>
            <div class="option-group">
                <label>
                    <input type="radio" name="analysis-type" value="fulltext" checked>
                    Fulltext分析 (完整引文分析)
                </label>
                <label>
                    <input type="radio" name="analysis-type" value="sliced">
                    Sliced分析 (引文一致性评估)
                </label>
            </div>
            
            <!-- Fulltext详细选项 -->
            <div id="fulltext-options" class="detailed-options">
                <h4>Fulltext分析详细选项</h4>
                <div class="detailed-option-group">
                    <label>
                        <input type="radio" name="fulltext-mode" value="all" checked>
                        分析所有数据
                    </label>
                    <label>
                        <input type="radio" name="fulltext-mode" value="head">
                        分析前N条数据
                    </label>
                    <label>
                        <input type="radio" name="fulltext-mode" value="specific">
                        分析指定rank的单条数据
                    </label>
                    <label>
                        <input type="radio" name="fulltext-mode" value="range">
                        从指定位置开始分析
                    </label>
                </div>
                
                <!-- 数值输入区域 -->
                <div class="number-inputs">
                    <div class="input-row" id="fulltext-head-input" style="display: none;">
                        <label>分析数量:</label>
                        <input type="number" id="fulltext-num-samples" min="1" placeholder="例如: 10">
                    </div>
                    <div class="input-row" id="fulltext-specific-input" style="display: none;">
                        <label>Rank编号:</label>
                        <input type="number" id="fulltext-specific-rank" min="1" placeholder="例如: 5">
                    </div>
                    <div class="input-row" id="fulltext-range-input" style="display: none;">
                        <label>起始位置:</label>
                        <input type="number" id="fulltext-start-from" min="1" placeholder="例如: 10">
                        <label>分析数量 (可选):</label>
                        <input type="number" id="fulltext-range-count" min="1" placeholder="留空表示到结尾">
                    </div>
                </div>
            </div>

            <!-- Sliced详细选项 -->
            <div id="sliced-options" class="detailed-options" style="display: none;">
                <h4>Sliced分析详细选项</h4>
                
                <!-- 执行模式选择 -->
                <div class="execution-mode-group">
                    <h5>执行模式:</h5>
                    <label>
                        <input type="radio" name="sliced-execution" value="sync" checked>
                        同步模式 (逐条处理，更稳定)
                    </label>
                    <label>
                        <input type="radio" name="sliced-execution" value="async">
                        异步模式 (并发处理，更快速)
                    </label>
                </div>

                <!-- 分析范围选择 -->
                <div class="sliced-scope-group">
                    <h5>分析范围:</h5>
                    <label>
                        <input type="radio" name="sliced-mode" value="all" checked>
                        分析所有数据
                    </label>
                    <label>
                        <input type="radio" name="sliced-mode" value="head">
                        分析前N条数据
                    </label>
                    <label>
                        <input type="radio" name="sliced-mode" value="specific">
                        分析指定rank的单条数据
                    </label>
                    <label>
                        <input type="radio" name="sliced-mode" value="range">
                        从指定位置开始分析
                    </label>
                </div>
                
                <!-- 数值输入区域 -->
                <div class="number-inputs">
                    <div class="input-row" id="sliced-head-input" style="display: none;">
                        <label>分析数量:</label>
                        <input type="number" id="sliced-num-samples" min="1" placeholder="例如: 10">
                    </div>
                    <div class="input-row" id="sliced-specific-input" style="display: none;">
                        <label>Rank编号:</label>
                        <input type="number" id="sliced-specific-rank" min="1" placeholder="例如: 5">
                    </div>
                    <div class="input-row" id="sliced-range-input" style="display: none;">
                        <label>起始位置:</label>
                        <input type="number" id="sliced-start-from" min="1" placeholder="例如: 10">
                        <label>分析数量 (可选):</label>
                        <input type="number" id="sliced-range-count" min="1" placeholder="留空表示到结尾">
                    </div>
                </div>
            </div>
        </div>

        <!-- 操作按钮 -->
        <div class="action-buttons">
            <button id="analyze-xlsx-btn" disabled>开始分析</button>
        </div>

        <!-- 分析结果 -->
        <div class="results-section">
            <h3>分析结果</h3>
            <div id="progress-info" class="progress-info"></div>
            <pre id="results-output">选择文件并配置API Key后开始分析...</pre>
        </div>

        <!-- 原有的文本分析功能 -->
        <hr>
        <div class="text-analysis-section">
            <h3>文本分析 (旧功能)</h3>
            <p>直接输入文本进行质量分析 (引文、一致性、幻觉检测)</p>
            <textarea id="text-input" rows="8" placeholder="在此粘贴AI生成的文本..."></textarea>
            <button id="analyze-btn">分析文本</button>
        </div>
    </div>
    <script src="/static/script.js"></script>
</body>
</html>
